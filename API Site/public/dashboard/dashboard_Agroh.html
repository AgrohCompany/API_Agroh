<!DOCTYPE html>  
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- esse link abaixo serve para deixar o icon do logo no navegador -->
    <link rel="shortcut icon" href="Imagens/logo-agroh.png">

    <title>AgrohCompany | Dashboard</title>

    <!-- 
    já esse link é dos gráficos de linhas e barras que temos,
    não sei se os polares vão precisar de link, caso sim, ele entra aqui
    em uma nova tag <script> para ele
    -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <link rel="stylesheet" href="dashboard_style.css">

    <script src="../js/funcoes.js"></script>
</head>
<body onload="validarSessao()">
  <!-- essa tag div global é toda a nossa naveção da página, ela foi difivida em partes -->
  <div id="global" class="global-class">

    <!-- uma das partes é a header-left "cabeçalho esquerdo da página" -->
      <div id="header-left" class="header-left-class">

        <div class="caixa-user-class">
            <h2>Olá, <span id="username">username</span></h2>
        </div>

        <div class="caixa2-postIt-class"> 
            <img src="Imagens/paperclip.png" style="height: 32px; display:flex; justify-content: flex-start">
        </div>
        
        <div id="calendario" class="caixa3-calendario-class">
            <img src="Imagens/Legenda.png" alt="" style="display: flex; height: 35vh; width: 35vw">
        </div>

      </div>
    <!-- fim do header-left, tudo que faz parte dela, no css estão com as bordas em RED para auxiliar na construção -->
    
    <!-- 
      outra parte é header-right toda parte direita da nossa página, temos uma mini nave, onde tem o logo, botões
      e logo abaixo os gráficos
    -->
      <div id="header-right" class="header-right-class">

        <!-- inicio da nave -->
        <div id="nave-header-right" class="nave-header-right-class">
            <img src="Imagens/logo-agroh&nome.jpeg" alt="logo-agrohCompany">
            <ul>
                <li><a href="#"><img src="Imagens/envelope.png" alt="imagem-envelope"></a></li>
                <li><a href="#"><img src="Imagens/notificacao.png" alt="imagem-notificação"></a></li>
                <li><a href="#"><img src="Imagens/avatar.png" alt="imagem-avatar"></a></li>
                <li><a href="#"><img src="Imagens/sair.png" alt="imagem-saida"></a></li>
            </ul>
        </div>
        <!-- fim da nave, tudo que faz parte dela, no css estão com as bordas em greenyellow -->

        <!-- inicio dos botões -->
        <div id="tabs" class="tabs-class">
            <button onclick="buttonDashboard()">Dashboard</button>
            <button onclick="buttonGrafico1()">Gráfico 1</button>
            <button onclick="buttonGrafico2()">Gráfico 2</button>
        </div>
        <!-- fim dos botões, tudo que faz parte deles, no css estão com as bordas pink -->

        <!-- inicio do body onde ficam os gráficos, no css ele está com as bordas em grey -->
        <div id="body-header-right" class="body-header-right-class">

          <!--
            inicio do body dois, ele é responsável em guardar as duas divs onde estão os gráficos,
            no css sua bordar é goldenrod
          -->
          <div id="body2-header-right" class="body2-header-right-class"> 

          <div id="noneEblockDash" style="display: block;"> <!-- none e block em teste-->

            <div id="body3-header-right" class="body3-header-right-class">

                <div class="body5-chartsPolares-class">

                    <div class="body5-1-chartsPolares-class">
                        <br>
                        Temperatura dos hectares
                        <canvas id="dht11Umidade" class="tamanhoGraficosPolares-class"></canvas>
                    </div>

                </div>

                <!-- aqui é a parte do centro dos dois gráficos polares, onde tem a temp e umi atual -->
                <div class="body4-temperatura-umidade-class">
                    <p>Temperatura atual</p>
                    <div style="height: 10vh; width: 10vh; background-color: orange; display:flex; justify-content: center; align-items: center;">0 °c</div>
                    <p>Umidade atual</p>
                    <div style="height: 10vh; width: 10vh; background-color: darkcyan; display:flex; justify-content: center; align-items: center;">0 %</div>
                </div>

                <div class="body5-chartsPolares-class">

                    <div class="body5-1-chartsPolares-class">
                        <br>
                        Umidade dos hectares
                        <canvas id="dht11Temperatura" class="tamanhoGraficosPolares-class"></canvas>
                    </div>

                </div>

            </div>

            <div id="body3-1-header-right" class="body3-1-header-right-class">

                <div>
                    <canvas id="canvasChartLine" class="tamanhoGraficosLineBar-class"></canvas>
                </div>

                <div>
                    <canvas id="canvasChartBar"  class="tamanhoGraficosLineBar-class"></canvas>
                </div>

            </div>

          </div>
          <!-- fim da div none&blockDash-->

          <div id="graficoLinhas2" class="graficoLinhas2-class">
            <div>
                <canvas id="canvasChartLine2" class="tamanhoGraficosLine-class2"></canvas>
            </div> 
          </div>

          <div id="graficoBarras2" class="graficoBarras2-class">
            <div>
                <canvas id="canvasChartBar2"  class="tamanhoGraficosBar-class2"></canvas>
            </div>
          </div>

        </div>
        <!-- fim do body 2 -->

        </div>
        <!-- fim do body com as bordas em grey -->

      </div>
      <!-- fim da header-right -->

  </div>
  <!-- fim da tag div global -->
</body>
</html>

<script>
  /* -- dht11Umidade -- */
  var contextoDht11Umidade = document.getElementById('dht11Umidade').getContext('2d');
  contextoDht11Umidade.canvas.width = 1000;
  contextoDht11Umidade.canvas.height = 300;
  var dht11Umidade = new Chart(
      contextoDht11Umidade,
      {
          type: 'line',
          data: {
              datasets: [{
                  label: 'Umidade',
                  type: 'line',
                  borderColor: ['#45b3e7'],
                  backgroundColor: ['#89cff0']
              }]
          },
          options: {
              scales: {
                  xAxes: [{
                      distribution: 'series',
                      ticks: {
                          beginAtZero: true
                      }
                  }],
                  yAxes: [{
                      scaleLabel: {
                          display: true,
                          labelString: 'Umidade'
                      },
                      ticks: {
                          beginAtZero: true
                      }
                  }]
              },
              animation: {
                  duration: 0
              }
          }
      }
  );
  /* -- dht11Temperatura -- */
  var contextoDht11Temperatura = document.getElementById('dht11Temperatura').getContext('2d');
  contextoDht11Temperatura.canvas.width = 1000;
  contextoDht11Temperatura.canvas.height = 300;
  var dht11Temperatura = new Chart(
      contextoDht11Temperatura,
      {
          type: 'line',
          data: {
              datasets: [{
                  label: "Temperatura",
                  type: 'line',
                  borderColor: ['#ff3232'],
                  backgroundColor: ['#ff7f7f']
              }]
          },
          options: {
              scales: {
                  xAxes: [{
                      distribution: 'series',
                      ticks: {
                          beginAtZero: true
                      }
                  }],
                  yAxes: [{
                      scaleLabel: {
                          display: true,
                          labelString: 'Luminosidade'
                      },
                      ticks: {
                          beginAtZero: true
                      }
                  }]
              },
              animation: {
                  duration: 0
              }
          }
      }
  );

  var paginacao = {};
  var tempo = {};
  function obterDados(grafico, endpoint) {
      var http = new XMLHttpRequest();
      http.open('GET', 'http://localhost:3000/sensores/' + endpoint, false);
      http.send(null);
      var valores = JSON.parse(http.responseText);
      if (paginacao[endpoint] == null) {
          paginacao[endpoint] = 0;
      }
      if (tempo[endpoint] == null) {
          tempo[endpoint] = 0;
      }
      // Exibir à partir do último elemento exibido anteriormente
      var ultimaPaginacao = paginacao[endpoint];
      paginacao[endpoint] = valores.length;
      var valores = valores.slice(ultimaPaginacao);
      valores.forEach((valor) => {
          //Máximo de 60 itens exibidos no gráfico
          if (grafico.data.labels.length == 10 && grafico.data.datasets[0].data.length == 10) {
              grafico.data.labels.shift();
              grafico.data.datasets[0].data.shift();
          }

          grafico.data.labels.push(tempo[endpoint]++);
          grafico.data.datasets[0].data.push(parseFloat(valor));
          grafico.update();
      })
  }

  setInterval(() => {
      obterDados(dht11Umidade, 'dht11/umidade');
      obterDados(dht11Temperatura, 'dht11/temperatura');
      obterDados(luminosidade, 'luminosidade');
      obterDados(lm35Temperatura, 'lm35/temperatura');
      obterDados(chave, 'chave');
  }, 1000);

</script>